<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Windows 98 Desktop</title>
    <link rel="stylesheet" href="https://unpkg.com/98.css" />
    <link rel="stylesheet" href="style/home.css" />
    <style>
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
        }
        body {
            min-height: 100vh;
            min-width: 100vw;
            overflow: hidden;
            background: #008080 url('https://win98icons.alexmeub.com/backgrounds/teal.png'); /* optional for extra Win98 vibe */
            font-family: "MS Sans Serif", Tahoma, Geneva, Verdana, sans-serif;
        }
        #desktop {
            height: 100vh;
            width: 100vw;
            position: relative;
            overflow: hidden;
        }
        .desktop-icon {
            position: absolute;
            width: 72px;
            user-select: none;
            text-align: center;
            z-index: 1;
            cursor: pointer;
            padding: 2px 3px 8px 3px;
        }
        .desktop-icon.selected {
            background: #316ac5;
            color: white;
            border: 1px dotted #fff;
        }
        .desktop-icon img {
            width: 36px;
            height: 36px;
            image-rendering: pixelated;
            margin: 0 auto 2px;
            display: block;
            background: transparent;
            pointer-events: none;
        }
        .icon-label {
            font-size: 13px;
            margin-top: 0;
            line-height: 1.1;
            padding: 0 2px;
            word-break: break-all;
            pointer-events: none;
            text-shadow: 1px 1px 0 #fff;
        }
    </style>
    <style>
        html {
            box-sizing:border-box
        }
        *,
        :after,
        :before {
            box-sizing:inherit;
            box-sizing:border-box
        }
        body {
            line-height:1.5;
            letter-spacing:-.025em;
            text-rendering:optimizeLegibility;
            -moz-osx-font-smoothing:grayscale;
            cursor:default;
            color:rgba(255,255,255,.8);
            -webkit-font-smoothing:antialiased;
            -moz-font-smoothing:antialiased;
            transition:background-color 1s ease .5s,color 1s ease .5s;
            background-color:teal
        }
        a {
            text-decoration:none;
            -webkit-user-select:none;
            -moz-user-select:none;
            -ms-user-select:none;
            user-select:none
        }
        .icon-inner-container .icon-box span,
        .ui-icon span {
            text-align:center;
            font-size:8px
        }
        .icon-inner-container .icon-box span {
            display:block;
            padding:4px 0 0
        }
        .icon-item a div {
            vertical-align:middle;
            max-height:64px;
            max-width:64px;
            margin-top:-60px;
            margin-left:10px
        }
        .ui_icon div {
            display:block;
            text-align:center
        }
        .ui-icon span {
            display:block;
            padding:4px 0 0
        }
        .start-bar {
            padding:2px;
            box-shadow:inset 1px 0 #fff;
            display:block;
            background-color:silver;
            bottom:0;
            left:0;
            right:0;
            border-top:1px solid #f4f4f4;
            border-bottom:1px solid #4e4e4e;
            position:fixed;
            z-index:99999;
            -webkit-user-select:none;
            -moz-user-select:none;
            -ms-user-select:none;
            user-select:none
        }
        .start-button {
            background-image:url(images/start-button.png);
            background-repeat:no-repeat;
            width:45px;
            height:14px
        }
        .start-button-wrapper {
            float:left;
            margin-left:2px;
            margin-bottom:2px;
            vertical-align:middle;
            display:inline-block;
            padding:2px 6px 3px;
            background-color:silver;
            border-top:1px solid #fff;
            border-left:1px solid #fff;
            border-right:1px solid gray;
            border-bottom:1px solid gray;
            box-shadow:inset 1px 1px #dfdfdf,1px 0 #000,0 1px #000,1px 1px #000;
            min-width:59px;
            margin-right:6px;
            color:#000
        }
        .start-bar-window {
            vertical-align:middle;
            height:22px;
            line-height:22px;
            border-right:1px solid #fff;
            border-bottom:1px solid #fff;
            font-family:Arial;
            font-weight:400;
            color:#000
        }
        .start-bar-window {
            float:left;
            padding:0 10px 0 6px;
            border-top:1px solid #000;
            border-left:1px solid #000;
            box-shadow:inset 1px 1px grey;
            background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAG0lEQVQYV2M8cODAf3t7ewbG/////z948CADAFuqCj64BtLKAAAAAElFTkSuQmCC)
        }

    </style>
</head>
<body>
<div id="desktop"></div>


<div class="start-bar">
    <a href="/home.html" title="Start Menu" class="button start-button-wrapper js-start-button">
        <div class="start-button"></div>
    </a>
    <span class="start-bar-window"><div class="sprite gallery"></div>Windows 98 Icon Viewer</span>
</div>

<script>
    // === Desktop Icon Configuration ===
    const ICONS = [
        {
            id: "settings",
            label: "Settings",
            icon: "/images/settings_gear.png",
            url: "/settings.html"
        },
        {
            id: "users",
            label: "Users",
            icon: "/images/address_book_card_users.png",
            url: "/users.html"
        },
        {
            id: "profile",
            label: "Profile",
            icon: "images/profile_icon.png",
            url: "/profile.html"
        }
    ];

    // === Restore positions from localStorage if available ===
    const positions = JSON.parse(localStorage.getItem("w98_desktop_positions")||"{}");

    const desktop = document.getElementById('desktop');
    ICONS.forEach((icon, idx) => {
        let div = document.createElement('div');
        div.className = 'desktop-icon';
        div.id = icon.id;
        div.innerHTML = `<img src="${icon.icon}" alt="" draggable="false"><div class="icon-label">${icon.label}</div>`;
        // Use saved or default position
        const pos = positions[icon.id] || { left: 40, top: 40 + idx*90 };
        div.style.left = pos.left + "px";
        div.style.top = pos.top + "px";
        // Keyboard nav support
        div.tabIndex = 0;
        desktop.appendChild(div);

        // Drag logic:
        let dragging = false, offsetX = 0, offsetY = 0;

        div.addEventListener('mousedown', (e) => {
            if (e.button !== 0) return;
            dragging = true;
            offsetX = e.clientX - div.offsetLeft;
            offsetY = e.clientY - div.offsetTop;
            div.style.zIndex = 99;
            div.classList.add('selected');
        });
        document.addEventListener('mousemove', (e) => {
            if (!dragging) return;
            let left = Math.max(0, Math.min(e.clientX - offsetX, window.innerWidth - div.offsetWidth));
            let top = Math.max(0, Math.min(e.clientY - offsetY, window.innerHeight - div.offsetHeight));
            div.style.left = left + 'px';
            div.style.top = top + 'px';
        });
        document.addEventListener('mouseup', (e) => {
            if (dragging) {
                dragging = false;
                div.style.zIndex = 1;

                // Snap to 80x90 grid
                const gridX = 80;
                const gridY = 90;
                let left = Math.round(parseInt(div.style.left, 10) / gridX) * gridX;
                let top = Math.round(parseInt(div.style.top, 10) / gridY) * gridY;

                // Ensure snapped positions stay within desktop bounds
                const desktopRect = desktop.getBoundingClientRect();
                left = Math.min(left, desktopRect.width - div.offsetWidth);
                top = Math.min(top, desktopRect.height - div.offsetHeight);

                div.style.left = left + 'px';
                div.style.top = top + 'px';

                positions[icon.id] = { left, top };
                localStorage.setItem("w98_desktop_positions", JSON.stringify(positions));
                div.classList.remove('selected');
            }
        });


        // Double click or press Enter to open the link
        div.addEventListener('dblclick', () => window.location = icon.url);
        div.addEventListener('keydown', (e) => {
            if (e.key === "Enter" || e.key === " ") window.location = icon.url;
        });

        // Visual selection on click/focus
        div.addEventListener('click', (e) => {
            document.querySelectorAll('.desktop-icon.selected').forEach(el=>el.classList.remove('selected'));
            div.classList.add('selected');
        });
        div.addEventListener('focus', (e) => {
            document.querySelectorAll('.desktop-icon.selected').forEach(el=>el.classList.remove('selected'));
            div.classList.add('selected');
        });
        div.addEventListener('blur', (e) => div.classList.remove('selected'));
    });

    // Optional: Prevent text selection during drag
    document.body.addEventListener('mousedown', (e) => {
        if (e.target.classList.contains('desktop-icon')) {
            e.preventDefault();
        }
    });

    // Responsive: keep icons in view if window is resized smaller
    window.addEventListener('resize', () => {
        // Clamp icon positions to the new window size
        document.querySelectorAll('.desktop-icon').forEach((div) => {
            let left = parseInt(div.style.left,10), top = parseInt(div.style.top,10);
            let changed = false;
            if (left > window.innerWidth - div.offsetWidth) {
                left = window.innerWidth - div.offsetWidth; changed = true;
            }
            if (top > window.innerHeight - div.offsetHeight) {
                top = window.innerHeight - div.offsetHeight; changed = true;
            }
            if (changed) {
                div.style.left = left + "px";
                div.style.top = top + "px";
                positions[div.id] = { left, top };
            }
        });
        localStorage.setItem("w98_desktop_positions", JSON.stringify(positions));
    });
</script>
</body>
</html>
taskbar